[package]
authors = ["Ryo ∴ SpiralArchitect <kishkavsesvit@icloud.com>"]
name = "st-tensor"
version = "0.1.0"
edition = "2021"
description = "SpiralTorch tensor utilities: fractional calculus (GL 1D) CPU + optional WGPU kernel"
license = "AGPL-3.0-or-later"

[lib]
crate-type = ["rlib", "cdylib"]

[features]
default = ["cpu", "faer", "wgpu_frac", "wgpu_dense"]
faer = ["dep:faer"]
simd = []

# CPU execution is always available, but expose a feature so that downstream
# crates can opt into a uniform interface when selecting backends.
cpu = []

# Keep the granular feature name for the fractional WGPU kernels while also
# providing the alias expected by the Python bindings (and end users invoking
# `--features wgpu`).
wgpu_frac = [
    "dep:wgpu",
    "dep:bytemuck",
    "dep:pollster",
    "dep:futures-intrusive",
    "dep:futures-lite",
]
wgpu_dense = ["wgpu_frac", "dep:anyhow"]
wgpu_f16 = ["wgpu_dense"]
wgpu = ["wgpu_dense"]

# Placeholder features for other accelerators.  These currently do not pull in
# additional dependencies but allow higher level crates to enable them without
# Cargo feature resolution failures.
mps = []
cuda = []
hip = ["dep:st-backend-hip"]

[dependencies]
# Deterministic sampling helpers for pure tensor stochastic initialisers.
rand = { version = "0.8", default-features = false, features = ["std", "std_rng"] }
rand_distr = { version = "0.4", default-features = false, features = ["std"] }
# Fractional calculus + FFT helpers shared with the WASM canvas transformer.
st-frac = { path = "../st-frac" }
# Kernel DSL utilities shared with the autotuner.
st-kdsl = { path = "../st-kdsl" }
spiral-config = { path = "../spiral-config" }
# Structured serialisation for gradient feedback packets shared across
# automation layers and WASM bindings.
serde = { version = "1.0", features = ["derive"], default-features = false }
serde_json = "1.0"
# High-performance SIMD dense linear algebra for CPU matmul acceleration.
faer = { version = "0.23", default-features = false, features = ["std", "rayon"], optional = true }
# Parallel execution for tiled CPU kernels.
rayon = { version = "1.10" }
# Optional; only needed if building WGPU kernel
wgpu = { version = "0.20", optional = true, features = ["wgsl"] }
bytemuck = { version = "1.15", features = ["derive"], optional = true }
pollster = { version = "0.3", optional = true }
futures-intrusive = { version = "0.5", optional = true }
futures-lite = { version = "1.13", optional = true }
once_cell = "1.21"
anyhow = { version = "1.0", optional = true }
st-backend-hip = { path = "../st-backend-hip", optional = true }

[dev-dependencies]
# Used in tests to validate conversions against ndarray utilities.
ndarray = { version = "0.15" }
# Criterion + Plotters power the tensor initialisation benchmarks.
criterion = { version = "0.5", features = ["html_reports"] }
plotters = { version = "0.3" }
naga = { version = "0.20", default-features = false, features = ["wgsl-in"] }

[[bench]]
name = "random_init"
harness = false

[package.metadata.spiraltorch]
copyright = "© 2025 Ryo ∴ SpiralArchitect — All rights reserved"
